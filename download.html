---
layout: main
title: Download Eagle Eyes Software
permalink: /download-pilot/
---

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="{{ '/shared.js' | relative_url }}"></script>

<style>
    .wizard-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 120px 20px 20px 20px;
    }
    
    .wizard-header {
        text-align: center;
        margin-bottom: 25px;
    }
    
    .wizard-header h1 {
        font-size: 26px;
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
    }
    
    .wizard-header p {
        color: #666;
        font-size: 16px;
        font-style: italic;
    }
    
    .wizard-progress {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 25px;
        padding: 0 20px;
    }
    
    .progress-step {
        position: relative;
        display: flex;
        align-items: center;
    }
    
    .step-circle {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: #e9ecef;
        border: 2px solid #e9ecef;
        position: relative;
        z-index: 2;
        transition: all 0.3s ease;
    }
    
    .progress-step.active .step-circle {
        background: #007bff;
        border-color: #007bff;
        width: 18px;
        height: 18px;
    }
    
    .progress-step.completed .step-circle {
        background: #28a745;
        border-color: #28a745;
    }
    
    .progress-line {
        width: 60px;
        height: 2px;
        background: #e9ecef;
        position: relative;
        z-index: 1;
    }
    
    .progress-step.completed + .progress-line {
        background: #28a745;
    }
    
    .wizard-content {
        background: white;
        border-radius: 12px;
        padding: 40px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        border: 1px solid #e9ecef;
        min-height: 400px;
    }
    
    .step-content {
        display: none;
    }
    
    .step-content.active {
        display: block;
        animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .step-title {
        font-size: 24px;
        font-weight: 600;
        color: #333;
        margin-bottom: 15px;
        text-align: center;
    }
    
    .step-description {
        color: #6c757d;
        font-size: 16px;
        text-align: center;
        margin-bottom: 30px;
    }
    
    .platform-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    /* Force 3 columns for desktop platform selection on wider screens */
    @media (min-width: 900px) {
        #step2a-desktop-platform .platform-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }
    
    /* 2 columns for medium screens */
    @media (min-width: 600px) and (max-width: 899px) {
        #step2a-desktop-platform .platform-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    
    .platform-card {
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 20px 15px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
    }
    
    /* First screen cards - reduce vertical padding only */
    #step1 .platform-card {
        padding: 5px 12px 8px 12px;
    }
    
    #step1 .platform-description {
        font-size: 13px;
        line-height: 1.3;
    }
    
    #step1 .platform-subtitle {
        font-size: 13px;
        margin-bottom: 10px;
    }
    
    .platform-card:hover {
        border-color: #007bff;
        background: #f0f8ff;
    }
    
    .platform-card.selected {
        border-color: #007bff;
        background: #e3f2fd;
    }
    
    .platform-card.recommended {
        border-color: #ffc107;
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    }
    
    .platform-card.recommended::before {
        content: "Recommended";
        position: absolute;
        top: -8px;
        right: 15px;
        background: #ffc107;
        color: #212529;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: bold;
        text-transform: uppercase;
    }
    
    .platform-icon {
        font-size: 48px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }
    
    .platform-icon img {
        width: 60px;
        height: auto;
    }
    
    /* Desktop platform selection specific styling */
    #step2a-desktop-platform .platform-icon {
        height: 120px;
        gap: 0px;
    }
    
    #step2a-desktop-platform .platform-icon img {
        max-width: 100px;
        max-height: 100px;
        width: auto;
        height: auto;
        object-fit: contain;
    }
    
    #step2a-desktop-platform .platform-icon img[src*="apple_fruit_logo"] {
        max-width: 32px;
        max-height: 32px;
        transform: translateY(-2px);
        margin-right: -12px;
    }
    
    .platform-title {
        font-size: 20px;
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
    }
    
    .platform-subtitle {
        color: #6c757d;
        font-size: 14px;
        margin-bottom: 15px;
    }
    
    .platform-description {
        color: #495057;
        font-size: 14px;
        line-height: 1.4;
    }
    
    .download-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
    }
    
    .download-button {
        background: #007bff;
        color: white;
        border: none;
        padding: 15px 20px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: background 0.2s ease;
        cursor: pointer;
    }
    
    .download-button:hover {
        background: #0056b3;
        color: white;
        text-decoration: none;
    }
    
    .download-button.secondary {
        background: #e9ecef;
        color: #495057;
    }
    
    .download-button.secondary:hover {
        background: #dee2e6;
        color: #495057;
    }
    
    .wizard-navigation {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #e9ecef;
    }
    
    .nav-button {
        background: #007bff;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s ease;
    }
    
    .nav-button:hover {
        background: #0056b3;
    }
    
    .nav-button:disabled {
        background: #6c757d;
        cursor: not-allowed;
    }
    
    .nav-button.secondary {
        background: #6c757d;
    }
    
    .nav-button.secondary:hover {
        background: #5a6268;
    }
    
    .setup-guide {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .setup-steps {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .setup-steps li {
        display: flex;
        align-items: flex-start;
        margin-bottom: 15px;
        padding: 15px;
        background: white;
        border-radius: 6px;
        border: 1px solid #dee2e6;
    }
    
    .setup-steps .step-number {
        background: #007bff;
        color: white;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 14px;
        margin-right: 15px;
        flex-shrink: 0;
    }
    
    .setup-steps .step-text {
        flex: 1;
    }
    
    .setup-steps .step-text strong {
        color: #333;
        display: block;
        margin-bottom: 5px;
    }
    
    .resources-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }
    
    .resource-link {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        padding: 15px;
        text-align: center;
        text-decoration: none;
        color: #495057;
        transition: all 0.2s ease;
    }
    
    .resource-link:hover {
        background: #007bff;
        color: white;
        text-decoration: none;
        border-color: #007bff;
    }
    
    .resource-icon {
        font-size: 24px;
        margin-bottom: 8px;
        display: block;
    }

    /* Mobile path specific styles */
    .drone-selection-container {
        margin-bottom: 30px;
    }
    
    .drone-selection-header {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin-bottom: 15px;
    }
    
    .search-container {
        margin-bottom: 15px;
        position: relative;
    }
    
    .search-input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        font-size: 14px;
        background: white;
    }
    
    .search-input:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 3px rgba(0,123,255,0.25);
    }
    
    .autocomplete-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #dee2e6;
        border-top: none;
        border-radius: 0 0 6px 6px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
    }
    
    .autocomplete-item {
        padding: 10px 12px;
        cursor: pointer;
        border-bottom: 1px solid #f1f1f1;
        font-size: 14px;
        transition: background-color 0.2s ease;
    }
    
    .autocomplete-item:last-child {
        border-bottom: none;
    }
    
    .autocomplete-item:hover {
        background-color: #f8f9fa;
    }
    
    .autocomplete-item.highlighted {
        background-color: #e3f2fd;
    }
    
    .no-results {
        padding: 10px 12px;
        color: #6c757d;
        font-style: italic;
        font-size: 14px;
    }
    
    .dropdown-container {
        position: relative;
    }
    
    .drone-dropdown {
        width: 100%;
        padding: 10px 40px 10px 12px; /* Add right padding for arrow */
        border: 1px solid #dee2e6;
        border-radius: 6px;
        font-size: 14px;
        background: white;
        cursor: pointer;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
    }
    
    .drone-dropdown:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 3px rgba(0,123,255,0.25);
    }
    
    .dropdown-arrow {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
        color: #6c757d;
        font-size: 14px;
        transition: transform 0.2s ease;
    }
    
    .drone-dropdown:focus + .dropdown-arrow {
        transform: translateY(-50%) rotate(180deg);
    }
    
    .drone-info-container {
        margin-top: 20px;
        display: none;
    }
    
    .controller-section {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .controller-section h4 {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .controller-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .controller-list li {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 8px 12px;
        margin-bottom: 8px;
        font-size: 14px;
        color: #495057;
    }
    
    .controller-list li:last-child {
        margin-bottom: 0;
    }
    
    .footnote-message {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
        color: #856404;
    }
    
    .footnote-message p {
        margin: 0;
        font-size: 14px;
        line-height: 1.4;
    }
    
    .compatibility-summary {
        background: #e3f2fd;
        border: 1px solid #2196f3;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        font-size: 15px;
        font-weight: 500;
    }
    
    .compatibility-summary.tested {
        background: #e8f5e8;
        border-color: #4caf50;
        color: #2e7d32;
    }
    
    .compatibility-summary.user-tested {
        background: #e3f2fd;
        border-color: #2196f3;
        color: #1565c0;
    }
    
    .compatibility-summary.untested {
        background: #fff8e1;
        border-color: #ff9800;
        color: #ef6c00;
    }
    
    .compatibility-summary.warning {
        background: #ffebee;
        border-color: #f44336;
        color: #c62828;
        margin-top: 10px;
    }
    
    .controller-bullet-list {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .controller-bullet-point {
        margin-bottom: 8px;
        font-size: 14px;
        line-height: 1.4;
        color: #495057;
    }
    
    .controller-bullet-point:last-child {
        margin-bottom: 0;
    }
    
    .compatibility-message {
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
    }
    
    .compatibility-supported {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
    }
    
    .compatibility-warning {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        color: #856404;
    }
    
    .compatibility-error {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
    }
    
    .download-versions {
        display: grid;
        gap: 20px;
    }
    
    .version-card {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 20px;
        transition: all 0.2s ease;
    }
    
    .version-card:hover {
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .version-header {
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #f1f1f1;
        position: relative;
    }
    
    .version-header .version-badge {
        position: absolute;
        top: 0;
        right: 0;
    }
    
    .version-name {
        font-size: 18px;
        font-weight: 600;
        color: #333;
    }
    
    .version-date {
        color: #6c757d;
        font-size: 14px;
    }
    
    .product-name {
        font-size: 16px;
        font-weight: 700;
        color: #333;
        margin-bottom: 5px;
    }
    
    .version-badge {
        background: #28a745;
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
        text-transform: uppercase;
    }
    
    .version-badge.stable {
        background: #28a745;
        color: white;
    }
    
    .version-badge.beta {
        background: #fd7e14;
        color: white;
    }
    
    .version-badge.alpha {
        background: #dc3545;
        color: white;
    }
    
    .release-notes {
        margin-bottom: 15px;
    }
    
    .release-notes h4 {
        font-size: 14px;
        font-weight: 600;
        color: #495057;
        margin-bottom: 8px;
    }
    
    .release-notes ul {
        margin: 0;
        padding-left: 20px;
        color: #6c757d;
        font-size: 14px;
        line-height: 1.5;
    }
    
    .version-actions {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    
    .file-info {
        color: #6c757d;
        font-size: 12px;
    }
    
    .loading-spinner {
        text-align: center;
        padding: 40px 20px;
    }
    
    .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #007bff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    /* License notice message */
    .license-notice {
        color: #6c757d;
        text-align: center;
        font-size: 14px;
        font-style: italic;
        margin-bottom: 25px;
    }
    
    .license-notice a {
        color: #007bff;
        text-decoration: none;
    }
    
    .license-notice a:hover {
        text-decoration: underline;
    }

    @media (max-width: 768px) {
        .wizard-container {
            padding: 100px 15px 15px 15px;
        }
        
        .wizard-content {
            padding: 20px;
        }
        
        .platform-grid {
            grid-template-columns: 1fr;
        }
        
        .wizard-progress {
            padding: 0 10px;
            margin-bottom: 30px;
        }
        
        .step-circle {
            width: 16px;
            height: 16px;
        }
        
        .progress-step.active .step-circle {
            width: 18px;
            height: 18px;
        }
        
        .progress-line {
            width: 40px;
            height: 2px;
        }
        
        .drone-selection-container {
            padding: 0 10px;
        }
        
        .version-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        
        .version-actions {
            flex-direction: column;
            align-items: stretch;
        }
        
        .download-button {
            justify-content: center;
        }
    }
</style>

<div class="wizard-container">
    <div class="wizard-header">
        <h1>Download Eagle Eyes</h1>
    </div>
    
    <div class="wizard-progress">
        <div class="progress-step active" id="progress1">
            <div class="step-circle"></div>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step" id="progress2">
            <div class="step-circle"></div>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step" id="progress3">
            <div class="step-circle"></div>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step" id="progress4">
            <div class="step-circle"></div>
        </div>
    </div>
    
    <div class="wizard-content">
        <!-- Step 1: Choose Platform -->
        <div id="step1" class="step-content active">
            <!-- License Notice - only on Step 1 -->
            <div class="license-notice">
                Our software requires an active license to access all features. Get one <a href="{{ '/pricing/' | relative_url }}">here</a>.
            </div>
            
            <!-- Mobile Setup Warning - only on Step 1 when Pilot selected -->
            <div id="mobile-setup-warning" class="compatibility-message compatibility-warning" style="display: none; margin-bottom: 20px;">
                <strong>Setup Tip:</strong> To make setup simple, open this page on the device you'll be installing Eagle Eyes Pilot on.
            </div>
            
            <h2 class="step-title">Choose Your Platform</h2>
            
            <div class="platform-grid">
                <div class="platform-card" onclick="selectPlatform('desktop')">
                    <span class="platform-icon">üñ•Ô∏è&nbsp;&nbsp;&nbsp;üíª&nbsp;&nbsp;&nbsp;<img src="{{ '/images/windows_tablet_icon.png' | relative_url }}" alt="Tablet" style="width: 48px; height: auto; vertical-align: middle;"></span>
                    <h3 class="platform-title">Eagle Eyes Scan</h3>
                    <p class="platform-subtitle">For Windows and macOS</p>
                    <div class="platform-description">
                        <p>Process live or pre-recorded drone footage for motion and color anomalies, with results and drone paths displayed on an interactive map.</p>
                    </div>
                </div>
                
                <div class="platform-card" onclick="selectPlatform('mobile')">
                    <span class="platform-icon">
                        <img src="{{ '/images/djicontroller.png' | relative_url }}" alt="DJI Controller">
                        üì±
                    </span>
                    <h3 class="platform-title">Eagle Eyes Pilot</h3>
                    <p class="platform-subtitle">For DJI controllers and Android devices</p>
                    <p class="platform-description">Sync with CalTopo, spot color and motion anomalies on your controller display, or coordinate multi-drone missions with nearby drone alerts.</p>
                </div>
            </div>
        </div>
        
        <!-- Step 2A: Desktop Platform Selection -->
        <div id="step2a-desktop-platform" class="step-content">
            <h2 class="step-title">Select Your Operating System</h2>
            
            <div class="platform-grid">
                <div class="platform-card" onclick="selectDesktopPlatform('windows')">
                    <div class="platform-icon">
                        <img src="{{ '/images/windows_logo.png' | relative_url }}" alt="Windows Logo">
                    </div>
                    <h3 class="platform-title">Windows</h3>
                    <p class="platform-subtitle">Windows 10 or newer</p>
                    <div class="platform-description">
                        <p>Compatible with all Windows 10 and Windows 11 systems.</p>
                    </div>
                </div>
                
                <div class="platform-card" onclick="selectDesktopPlatform('macos-apple')">
                    <div class="platform-icon">
                        <img src="{{ '/images/apple_fruit_logo.png' | relative_url }}" alt="Apple Logo">
                        <img src="{{ '/images/macos_logo.png' | relative_url }}" alt="macOS Logo">
                    </div>
                    <h3 class="platform-title">macOS (Apple silicon)</h3>
                    <p class="platform-subtitle">M1, M2, M3, M4 chips</p>
                    <div class="platform-description">
                        <p>Optimized for Apple's ARM64 architecture. Best performance on modern Macs.</p>
                    </div>
                </div>
                
                <div class="platform-card" onclick="selectDesktopPlatform('macos-intel')">
                    <div class="platform-icon">
                        <img src="{{ '/images/apple_fruit_logo.png' | relative_url }}" alt="Apple Logo">
                        <img src="{{ '/images/macos_logo.png' | relative_url }}" alt="macOS Logo">
                    </div>
                    <h3 class="platform-title">macOS (Intel)</h3>
                    <p class="platform-subtitle">Intel-based Macs</p>
                    <div class="platform-description">
                        <p>For older Intel-based Mac computers (x86 architecture).</p>
                    </div>
                </div>
            </div>
            
            <div id="intel-warning" class="compatibility-message compatibility-warning" style="display: none;">
                When using an Apple machine, we recommend devices with Apple silicon (ARM64 architecture, such as M1, M2, M3, and M4 chipsets). The performance of this Intel-based (x86) distribution may vary.
            </div>
        </div>
        
        <!-- Step 2B: Mobile Device Selection -->
        <div id="step2b-mobile" class="step-content">
            <h2 class="step-title">Select Your Drone</h2>
            
            <!-- Loading State -->
            <div id="drones-loading" class="loading-spinner" style="display: none;">
                <div class="spinner"></div>
                <p>Loading drone models...</p>
            </div>
            
            <!-- Error State -->
            <div id="drones-error" style="display: none; text-align: center; padding: 20px; color: #dc3545;">
                <p>Unable to load drone models. Please try again.</p>
                <button class="nav-button" onclick="loadDroneModels()" style="margin-top: 10px;">Retry</button>
            </div>
            
            <!-- Drone Selection -->
            <div id="drone-selection-content" class="drone-selection-container" style="display: none;">
                
                <!-- Search Bar -->
                <div class="search-container">
                    <input type="text" id="drone-search" class="search-input" placeholder="Search for your drone model..." 
                           oninput="handleSearchInput()" onkeydown="handleSearchKeydown(event)" onfocus="showAutocomplete()" onblur="hideAutocomplete()">
                    <div id="autocomplete-dropdown" class="autocomplete-dropdown">
                        <!-- Autocomplete suggestions will be populated here -->
                    </div>
                </div>
                
                <!-- Drone Dropdown -->
                <div class="dropdown-container">
                    <select id="drone-dropdown" class="drone-dropdown" onchange="selectDroneFromDropdown()">
                        <option value="">-- Select a drone model --</option>
                    </select>
                    <span class="dropdown-arrow">‚ñº</span>
                </div>
                
                <!-- Drone Info Display -->
                <div id="drone-info-container" class="drone-info-container">
                    <!-- Controller compatibility sections will be populated here -->
                </div>
            </div>
        </div>
        
        <!-- Step 3: Download Options -->
        <div id="step3-downloads" class="step-content">
            <h2 class="step-title" id="download-title">Download Software</h2>
            <p class="step-description" id="download-description">Choose from available versions</p>
            
            <!-- Loading State -->
            <div id="downloads-loading" class="loading-spinner" style="display: none;">
                <div class="spinner"></div>
                <p>Loading available downloads...</p>
            </div>
            
            <!-- Desktop Downloads -->
            <div id="desktop-downloads" style="display: none;">
                <div class="download-versions" id="desktop-versions">
                    <!-- Version cards will be populated here -->
                </div>
            </div>
            
            <!-- Mobile Downloads -->
            <div id="mobile-downloads" style="display: none;">
                <div class="download-versions" id="mobile-versions">
                    <!-- Version cards will be populated here -->
                </div>
            </div>
            
            <!-- Error State -->
            <div id="downloads-error" style="display: none; text-align: center; padding: 40px; color: #6c757d;">
                <p>Unable to load download options. Please try again later.</p>
                <button class="download-button" onclick="loadDownloads()">Retry</button>
            </div>
        </div>
        
        <!-- Step 4: Setup Instructions -->
        <div id="step4-setup" class="step-content">
            <h2 class="step-title">Setup Instructions</h2>
            <p class="step-description" id="setup-description">Follow these steps to activate your Eagle Eyes software</p>
            
            <div class="setup-guide">
                <ol class="setup-steps" id="setup-steps">
                    <!-- Steps will be populated by JavaScript -->
                </ol>
            </div>
            
            <div class="resources-grid">
                <a href="#" class="resource-link" id="tutorial-link" target="_blank">
                    <span class="resource-icon">üé•</span>
                    <div>Quick Start Guide</div>
                </a>
                <a href="#" class="resource-link" id="manual-link" target="_blank">
                    <span class="resource-icon">üìñ</span>
                    <div>User Manual</div>
                </a>
                <a href="https://www.eagleeyessearch.com/faq" class="resource-link" target="_blank">
                    <span class="resource-icon">‚ùì</span>
                    <div>FAQ & Support</div>
                </a>
            </div>
        </div>
        
        <div class="wizard-navigation">
            <button class="nav-button secondary" id="prevButton" onclick="previousStep()" disabled>Previous</button>
            <div id="stepIndicator">Step 1 of 4</div>
            <button class="nav-button" id="nextButton" onclick="nextStep()" disabled>Next</button>
        </div>
    </div>
</div>

<script>
    var useLocalFirebaseEmulator = getIsEmulatorFromURL();
    var hostURL = useLocalFirebaseEmulator ? 'http://127.0.0.1:5001/eagleeyessearch/us-central1' : 'https://us-central1-eagleeyessearch.cloudfunctions.net';
    
    let currentStep = 1;
    let selectedPlatform = null;
    let selectedOSPlatform = null;
    let selectedDownload = null;
    let selectedDrone = null;
    let selectedController = null;
    
    $(document).ready(function() {
        setupMobileDeviceSelection();
    });
    
    let droneModelsData = [];
    let filteredDroneModels = [];
    let currentHighlightIndex = -1;
    
    async function loadDroneModels() {
        try {
            // Add null checks for all elements
            const loadingElement = document.getElementById('drones-loading');
            const errorElement = document.getElementById('drones-error');
            const selectionContent = document.getElementById('drone-selection-content');
            
            if (!loadingElement) {
                console.error('Loading element not found');
                return;
            }
            
            if (!errorElement) {
                console.error('Error element not found');
                return;
            }
            
            loadingElement.style.display = 'block';
            errorElement.style.display = 'none';
            
            // Hide selection content while loading
            if (selectionContent) {
                selectionContent.style.display = 'none';
            }
            
            const response = await fetch(`${hostURL}/get_drone_models`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            
            if (!response.ok) {
                throw new Error('Failed to fetch drone models');
            }
            
            const data = await response.json();
            console.log('Drone models API response:', data);
            
            droneModelsData = data.drones || [];
            displayDroneModels(droneModelsData);
            
        } catch (error) {
            console.error('Error loading drone models:', error);
            
            // Safe error display with null checks
            const loadingElement = document.getElementById('drones-loading');
            const errorElement = document.getElementById('drones-error');
            
            if (loadingElement) {
                loadingElement.style.display = 'none';
            }
            if (errorElement) {
                errorElement.style.display = 'block';
            }
        }
    }
    
    function displayDroneModels(drones) {
        const dropdown = document.getElementById('drone-dropdown');
        const loadingElement = document.getElementById('drones-loading');
        const selectionContent = document.getElementById('drone-selection-content');
        
        // Add null checks
        if (!dropdown) {
            console.error('Drone dropdown element not found');
            return;
        }
        
        dropdown.innerHTML = '<option value="">-- Select a drone model --</option>';
        
        if (!drones || drones.length === 0) {
            if (loadingElement) {
                loadingElement.style.display = 'none';
            }
            if (selectionContent) {
                selectionContent.style.display = 'block';
            }
            dropdown.innerHTML = '<option value="">No drone models available</option>';
            return;
        }
        
        // Sort drones alphabetically by display name
        const sortedDrones = drones.slice().sort((a, b) => {
            const nameA = `${a.brand} ${a.name}`.toLowerCase();
            const nameB = `${b.brand} ${b.name}`.toLowerCase();
            return nameA.localeCompare(nameB);
        });
        
        sortedDrones.forEach((drone, index) => {
            const option = document.createElement('option');
            const displayName = `${drone.brand} ${drone.name}`;
            option.value = index; // Use sorted index instead of original index
            option.textContent = displayName;
            option.setAttribute('data-drone-data', JSON.stringify(drone));
            dropdown.appendChild(option);
        });
        
        // Add "Other drone make or model" option at the end
        const otherOption = document.createElement('option');
        otherOption.value = 'other';
        otherOption.textContent = 'Other drone make or model';
        otherOption.setAttribute('data-drone-data', JSON.stringify({
            name: 'Other drone make or model',
            brand: '',
            controllers_internally_tested: [],
            controllers_user_tested: [],
            controllers_not_tested: [],
            controllers_incompatible: [],
            footnotes: 'We currently only support the drone models shown in the above list. If you would like to see support for your drone, please let us know via info@eagleeyessearch.com. We can\'t promise anything, but we would like to be aware of the demand.'
        }));
        dropdown.appendChild(otherOption);
        
        // Store sorted drones for consistent access
        droneModelsData = sortedDrones;
        
        if (loadingElement) {
            loadingElement.style.display = 'none';
        }
        if (selectionContent) {
            selectionContent.style.display = 'block';
        }
    }
    
    function handleSearchInput() {
        const searchInput = document.getElementById('drone-search');
        const autocompleteDropdown = document.getElementById('autocomplete-dropdown');
        
        // Add null checks
        if (!searchInput || !autocompleteDropdown) {
            console.error('Search input or autocomplete dropdown element not found');
            return;
        }
        
        const searchTerm = searchInput.value.toLowerCase().trim();
        currentHighlightIndex = -1;
        
        if (searchTerm.length === 0) {
            hideAutocomplete();
            return;
        }
        
        // Filter drone models based on search term
        filteredDroneModels = droneModelsData.filter(drone => {
            const displayName = `${drone.brand} ${drone.name}`.toLowerCase();
            return displayName.includes(searchTerm);
        });
        
        updateAutocompleteDropdown();
        showAutocomplete();
    }
    
    function updateAutocompleteDropdown() {
        const autocompleteDropdown = document.getElementById('autocomplete-dropdown');
        
        if (!autocompleteDropdown) {
            return;
        }
        
        autocompleteDropdown.innerHTML = '';
        
        if (filteredDroneModels.length === 0) {
            const noResultsDiv = document.createElement('div');
            noResultsDiv.className = 'no-results';
            noResultsDiv.textContent = 'No drone models found';
            autocompleteDropdown.appendChild(noResultsDiv);
        } else {
            filteredDroneModels.slice(0, 8).forEach((drone, index) => { // Limit to 8 results
                const item = document.createElement('div');
                item.className = 'autocomplete-item';
                item.textContent = `${drone.brand} ${drone.name}`;
                item.setAttribute('data-drone-index', droneModelsData.findIndex(d => d.name === drone.name && d.brand === drone.brand));
                item.setAttribute('data-drone-data', JSON.stringify(drone));
                
                item.addEventListener('mousedown', function() {
                    selectDroneFromAutocomplete(drone);
                });
                
                autocompleteDropdown.appendChild(item);
            });
        }
    }
    
    function handleSearchKeydown(event) {
        const autocompleteDropdown = document.getElementById('autocomplete-dropdown');
        const items = autocompleteDropdown ? autocompleteDropdown.querySelectorAll('.autocomplete-item') : [];
        
        if (items.length === 0) return;
        
        switch (event.key) {
            case 'ArrowDown':
                event.preventDefault();
                currentHighlightIndex = Math.min(currentHighlightIndex + 1, items.length - 1);
                updateHighlight(items);
                break;
                
            case 'ArrowUp':
                event.preventDefault();
                currentHighlightIndex = Math.max(currentHighlightIndex - 1, -1);
                updateHighlight(items);
                break;
                
            case 'Enter':
                event.preventDefault();
                if (currentHighlightIndex >= 0 && currentHighlightIndex < items.length) {
                    const selectedItem = items[currentHighlightIndex];
                    const droneData = JSON.parse(selectedItem.getAttribute('data-drone-data'));
                    selectDroneFromAutocomplete(droneData);
                }
                break;
                
            case 'Escape':
                hideAutocomplete();
                break;
        }
    }
    
    function updateHighlight(items) {
        items.forEach((item, index) => {
            if (index === currentHighlightIndex) {
                item.classList.add('highlighted');
            } else {
                item.classList.remove('highlighted');
            }
        });
    }
    
    function selectDroneFromAutocomplete(droneData) {
        const searchInput = document.getElementById('drone-search');
        const dropdown = document.getElementById('drone-dropdown');
        
        if (!searchInput || !dropdown) {
            return;
        }
        
        // Set search input value
        searchInput.value = `${droneData.brand} ${droneData.name}`;
        
        // Set dropdown value (droneModelsData is now sorted)
        const droneIndex = droneModelsData.findIndex(drone => 
            drone.name === droneData.name && drone.brand === droneData.brand
        );
        dropdown.value = droneIndex;
        
        // Update selected drone
        selectedDrone = {
            device: `drone-${droneIndex}`,
            compatibility: 'selected',
            name: `${droneData.brand} ${droneData.name}`,
            data: droneData
        };
        
        // Display drone info and update navigation
        displayDroneInfo(droneData);
        updateMobileNextButton();
        
        // Hide autocomplete
        hideAutocomplete();
    }
    
    function showAutocomplete() {
        const autocompleteDropdown = document.getElementById('autocomplete-dropdown');
        if (autocompleteDropdown && filteredDroneModels.length > 0) {
            autocompleteDropdown.style.display = 'block';
        }
    }
    
    function hideAutocomplete() {
        const autocompleteDropdown = document.getElementById('autocomplete-dropdown');
        if (autocompleteDropdown) {
            // Use setTimeout to allow click events to fire before hiding
            setTimeout(() => {
                autocompleteDropdown.style.display = 'none';
            }, 150);
        }
    }
    
    function selectDroneFromDropdown() {
        const dropdown = document.getElementById('drone-dropdown');
        const infoContainer = document.getElementById('drone-info-container');
        
        // Add null checks
        if (!dropdown) {
            console.error('Drone dropdown element not found');
            return;
        }
        
        const selectedIndex = dropdown.value;
        
        if (!selectedIndex) {
            if (infoContainer) {
                infoContainer.style.display = 'none';
            }
            selectedDrone = null;
            updateMobileNextButton();
            return;
        }
        
        // Handle "Other drone make or model" selection
        if (selectedIndex === 'other') {
            const otherDroneData = {
                name: 'Other drone make or model',
                brand: '',
                controllers_internally_tested: [],
                controllers_user_tested: [],
                controllers_not_tested: [],
                controllers_incompatible: [],
                footnotes: 'We currently only support the drone models shown in the above list. If you would like to see support for your drone, please let us know via info@eagleeyessearch.com. We can\'t promise anything, but we would like to be aware of the demand.'
            };
            
            selectedDrone = {
                device: 'drone-other',
                compatibility: 'unsupported',
                name: 'Other drone make or model',
                data: otherDroneData
            };
            
            displayDroneInfo(otherDroneData);
            updateMobileNextButton();
            return;
        }
        
        const selectedOption = dropdown.options[parseInt(selectedIndex) + 1]; // +1 because of the placeholder option
        
        if (!selectedOption) {
            console.error('Selected option not found');
            return;
        }
        
        const droneDataAttr = selectedOption.getAttribute('data-drone-data');
        if (!droneDataAttr) {
            console.error('Drone data attribute not found');
            return;
        }
        
        console.log('Selected drone index:', selectedIndex);
        console.log('Raw drone data attribute:', droneDataAttr);
        
        const droneData = JSON.parse(droneDataAttr);
        console.log('Parsed drone data:', droneData);
        
        selectedDrone = {
            device: `drone-${selectedIndex}`,
            compatibility: 'selected',
            name: `${droneData.brand} ${droneData.name}`,
            data: droneData
        };
        
        displayDroneInfo(droneData);
        updateMobileNextButton();
    }
    
    function displayDroneInfo(drone) {
        const infoContainer = document.getElementById('drone-info-container');
        
        // Add null check
        if (!infoContainer) {
            console.error('Drone info container element not found');
            return;
        }
        
        // Debug logging to track the issue
        console.log('displayDroneInfo called with drone:', drone);
        console.log('Drone name:', drone.name);
        console.log('Controllers internally tested:', drone.controllers_internally_tested);
        console.log('Controllers user tested:', drone.controllers_user_tested);
        console.log('Controllers not tested:', drone.controllers_not_tested);
        console.log('Controllers incompatible:', drone.controllers_incompatible);
        
        infoContainer.innerHTML = '';
        
        // Generate and display compatibility summary
        const summary = generateCompatibilitySummary(drone);
        if (summary) {
            infoContainer.appendChild(summary);
        }
        
        // Show controller compatibility as bullet points
        const controllerInfo = document.createElement('div');
        controllerInfo.className = 'controller-bullet-list';
        
        const internallyTested = drone.controllers_internally_tested || [];
        const userTested = drone.controllers_user_tested || [];
        const notTested = drone.controllers_not_tested || [];
        const incompatible = drone.controllers_incompatible || [];
        
        let bulletPoints = [];
        
        if (internallyTested.length > 0) {
            const bulletDiv = document.createElement('div');
            bulletDiv.className = 'controller-bullet-point';
            bulletDiv.innerHTML = `‚Ä¢ This drone has been tested by us to work with these controllers: <strong>${internallyTested.join(', ')}</strong>`;
            controllerInfo.appendChild(bulletDiv);
        }
        
        if (userTested.length > 0) {
            const bulletDiv = document.createElement('div');
            bulletDiv.className = 'controller-bullet-point';
            bulletDiv.innerHTML = `‚Ä¢ This drone has been tested by users to work with these controllers: <strong>${userTested.join(', ')}</strong>`;
            controllerInfo.appendChild(bulletDiv);
        }
        
        if (notTested.length > 0) {
            const bulletDiv = document.createElement('div');
            bulletDiv.className = 'controller-bullet-point';
            bulletDiv.innerHTML = `‚Ä¢ Eagle Eyes Pilot should be compatible with these controllers, but is not tested yet: <strong>${notTested.join(', ')}</strong>`;
            controllerInfo.appendChild(bulletDiv);
        }
        
        if (incompatible.length > 0) {
            const bulletDiv = document.createElement('div');
            bulletDiv.className = 'controller-bullet-point';
            bulletDiv.innerHTML = `‚Ä¢ Controllers <strong>not</strong> compatible with this drone or with Eagle Eyes Pilot: <strong>${incompatible.join(', ')}</strong>`;
            controllerInfo.appendChild(bulletDiv);
        }
        
        // Add footnotes to the controller info if available
        if (drone.footnotes && drone.footnotes.trim()) {
            const footnoteDiv = document.createElement('div');
            footnoteDiv.className = 'controller-bullet-point';
            footnoteDiv.style.marginTop = '15px';
            footnoteDiv.style.paddingTop = '15px';
            footnoteDiv.style.borderTop = '1px solid #dee2e6';
            footnoteDiv.style.fontStyle = 'italic';
            footnoteDiv.style.color = '#856404';
            footnoteDiv.innerHTML = `<strong>Note:</strong> ${drone.footnotes}`;
            controllerInfo.appendChild(footnoteDiv);
        }
        
        // Show controller info if there are controllers OR footnotes
        if (internallyTested.length > 0 || userTested.length > 0 || notTested.length > 0 || incompatible.length > 0 || (drone.footnotes && drone.footnotes.trim())) {
            infoContainer.appendChild(controllerInfo);
        }
        
        infoContainer.style.display = 'block';
    }
    
    function generateCompatibilitySummary(drone) {
        const internallyTested = drone.controllers_internally_tested || [];
        const userTested = drone.controllers_user_tested || [];
        const notTested = drone.controllers_not_tested || [];
        const incompatible = drone.controllers_incompatible || [];
        
        const summaryDiv = document.createElement('div');
        summaryDiv.className = 'compatibility-summary';
        
        let summaryText = '';
        let summaryClass = '';
        
        // Determine compatibility status
        if (internallyTested.length > 0 && userTested.length > 0) {
            summaryText = 'This drone has been tested for compatibility by us and our users.';
            summaryClass = 'tested';
        } else if (internallyTested.length > 0) {
            summaryText = 'This drone has been tested for compatibility by us.';
            summaryClass = 'tested';
        } else if (userTested.length > 0) {
            summaryText = 'This drone has been tested for compatibility by our users.';
            summaryClass = 'user-tested';
        } else if (notTested.length > 0) {
            summaryText = 'This drone should be compatible but is not tested yet.';
            summaryClass = 'untested';
        } else {
            // No controllers at all - don't show compatibility summary
            return null;
        }
        
        summaryDiv.className += ` ${summaryClass}`;
        summaryDiv.textContent = summaryText;
        
        // Check if there are any controllers to show
        const hasControllers = internallyTested.length > 0 || userTested.length > 0 || notTested.length > 0 || incompatible.length > 0;
        
        // Add additional info message if controllers are present
        if (hasControllers) {
            summaryDiv.textContent += ' See below for compatibility information about your specific controller.';
        }
        
        // Add warning if there are incompatible controllers
        if (incompatible.length > 0) {
            const warningDiv = document.createElement('div');
            warningDiv.className = 'compatibility-summary warning';
            warningDiv.textContent = 'Attention: Some of the controllers that work with this drone are not compatible with Eagle Eyes Pilot.';
            
            const container = document.createElement('div');
            container.appendChild(summaryDiv);
            container.appendChild(warningDiv);
            return container;
        }
        
        return summaryDiv;
    }
    
    function getDroneCompatibility(drone) {
        const internallyTested = drone.controllers_internally_tested || [];
        const userTested = drone.controllers_user_tested || [];
        const notTested = drone.controllers_not_tested || [];
        const incompatible = drone.controllers_incompatible || [];
        
        if (internallyTested.length > 0 || userTested.length > 0) {
            return {
                level: 'supported',
                cssClass: '',
                statusClass: 'status-supported',
                text: '‚úÖ Fully Supported'
            };
        } else if (notTested.length > 0) {
            return {
                level: 'untested',
                cssClass: 'untested',
                statusClass: 'status-untested',
                text: '‚ö†Ô∏è May Work'
            };
        } else if (incompatible.length > 0) {
            return {
                level: 'incompatible',
                cssClass: 'incompatible',
                statusClass: 'status-incompatible',
                text: '‚ùå Not Supported'
            };
        } else {
            return {
                level: 'untested',
                cssClass: 'untested',
                statusClass: 'status-untested',
                text: '‚ö†Ô∏è Unknown'
            };
        }
    }
    
    function selectDroneModel(element, droneData) {
        // Remove previous selections
        document.querySelectorAll('#droneList .device-tile').forEach(tile => {
            tile.classList.remove('selected');
        });
        
        // Select current drone
        element.classList.add('selected');
        
        selectedDrone = {
            device: element.getAttribute('data-device'),
            compatibility: element.getAttribute('data-compatibility'),
            name: droneData.name,
            data: droneData
        };
        
        // Update controller list based on selected drone
        updateControllerList(droneData);
        updateCompatibilityMessage();
        updateMobileNextButton();
    }
    
    function updateControllerList(droneData) {
        const controllerList = document.getElementById('controllerList');
        controllerList.innerHTML = '';
        
        // Collect all controllers from different categories
        const allControllers = [
            ...(droneData.controllers_internally_tested || []).map(name => ({ name, status: 'supported', category: 'internally_tested' })),
            ...(droneData.controllers_user_tested || []).map(name => ({ name, status: 'supported', category: 'user_tested' })),
            ...(droneData.controllers_not_tested || []).map(name => ({ name, status: 'untested', category: 'not_tested' })),
            ...(droneData.controllers_incompatible || []).map(name => ({ name, status: 'incompatible', category: 'incompatible' }))
        ];
        
        // Add Android device option
        allControllers.push({ name: 'Android Device', status: 'supported', category: 'general' });
        
        if (allControllers.length === 0) {
            controllerList.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 20px;">No controllers available for this drone.</p>';
            return;
        }
        
        allControllers.forEach((controller, index) => {
            const controllerId = `controller-${index}`;
            const compatibility = getControllerCompatibilityDisplay(controller.status);
            
            const deviceTile = document.createElement('div');
            deviceTile.className = `device-tile ${compatibility.cssClass}`;
            deviceTile.setAttribute('data-device', controllerId);
            deviceTile.setAttribute('data-compatibility', controller.status);
            
            deviceTile.innerHTML = `
                <div class="device-image">${controller.name === 'Android Device' ? 'üì±' : 'üéÆ'}</div>
                <div class="device-info">
                    <div class="device-name">${controller.name}</div>
                    <div class="compatibility-status ${compatibility.statusClass}">${compatibility.text}</div>
                </div>
            `;
            
            deviceTile.addEventListener('click', function() {
                selectControllerModel(this, controller);
            });
            
            controllerList.appendChild(deviceTile);
        });
    }
    
    function getControllerCompatibilityDisplay(status) {
        switch (status) {
            case 'supported':
                return {
                    cssClass: '',
                    statusClass: 'status-supported',
                    text: '‚úÖ Fully Supported'
                };
            case 'untested':
                return {
                    cssClass: 'untested',
                    statusClass: 'status-untested',
                    text: '‚ö†Ô∏è May Work'
                };
            case 'incompatible':
                return {
                    cssClass: 'incompatible',
                    statusClass: 'status-incompatible',
                    text: '‚ùå Not Supported'
                };
            default:
                return {
                    cssClass: 'untested',
                    statusClass: 'status-untested',
                    text: '‚ö†Ô∏è Unknown'
                };
        }
    }
    
    function selectControllerModel(element, controllerData) {
        // Remove previous selections
        document.querySelectorAll('#controllerList .device-tile').forEach(tile => {
            tile.classList.remove('selected');
        });
        
        // Select current controller
        element.classList.add('selected');
        
        selectedController = {
            device: element.getAttribute('data-device'),
            compatibility: element.getAttribute('data-compatibility'),
            name: controllerData.name,
            data: controllerData
        };
        
        updateCompatibilityMessage();
        updateMobileNextButton();
    }
    
    function selectPlatform(platform) {
        selectedPlatform = platform;
        
        // Remove previous selections
        document.querySelectorAll('.platform-card').forEach(card => {
            card.classList.remove('selected');
        });
        
        // Select current platform
        event.currentTarget.classList.add('selected');
        
        // Show/hide mobile setup warning
        const mobileWarning = document.getElementById('mobile-setup-warning');
        if (platform === 'mobile') {
            mobileWarning.style.display = 'block';
        } else {
            mobileWarning.style.display = 'none';
        }
        
        // Enable next button
        document.getElementById('nextButton').disabled = false;
        
        console.log('Selected platform:', platform);
    }
    
    function selectDesktopPlatform(osPlatform) {
        selectedOSPlatform = osPlatform;
        
        // Remove previous selections
        document.querySelectorAll('#step2a-desktop-platform .platform-card').forEach(card => {
            card.classList.remove('selected');
        });
        
        // Select current platform
        event.currentTarget.classList.add('selected');
        
        // Show/hide Intel warning
        const intelWarning = document.getElementById('intel-warning');
        if (osPlatform === 'macos-intel') {
            intelWarning.style.display = 'block';
        } else {
            intelWarning.style.display = 'none';
        }
        
        // Enable next button
        document.getElementById('nextButton').disabled = false;
        
        console.log('Selected OS platform:', osPlatform);
    }
    
    function downloadSelected(download) {
        selectedDownload = download;
        console.log('Download selected:', download);
        
        // Auto-advance to next step after selection
        setTimeout(() => {
            nextStep();
        }, 500);
    }
    
    function nextStep() {
        if (currentStep === 1 && selectedPlatform) {
            currentStep = 2;
            showStep2();
        } else if (currentStep === 2) {
            currentStep = 3;
            showStep3();
        } else if (currentStep === 3) {
            currentStep = 4;
            showStep4();
        }
        updateProgress();
    }
    
    function previousStep() {
        if (currentStep === 2) {
            currentStep = 1;
            showStep1();
        } else if (currentStep === 3) {
            currentStep = 2;
            showStep2();
        } else if (currentStep === 4) {
            currentStep = 3;
            showStep3();
        }
        updateProgress();
    }
    
    function showStep1() {
        // Hide all steps
        document.querySelectorAll('.step-content').forEach(step => {
            step.classList.remove('active');
        });
        
        // Show step 1
        document.getElementById('step1').classList.add('active');
        
        // Update navigation
        document.getElementById('prevButton').disabled = true;
        document.getElementById('nextButton').disabled = !selectedPlatform;
        document.getElementById('stepIndicator').textContent = 'Step 1 of 4';
    }
    
    function showStep2() {
        // Hide all steps
        document.querySelectorAll('.step-content').forEach(step => {
            step.classList.remove('active');
        });
        
        // Show appropriate step 2 based on platform
        if (selectedPlatform === 'desktop') {
            document.getElementById('step2a-desktop-platform').classList.add('active');
        } else if (selectedPlatform === 'mobile') {
            document.getElementById('step2b-mobile').classList.add('active');
            // Load drone models when entering mobile step
            loadDroneModels();
        }
        
        // Update navigation
        document.getElementById('prevButton').disabled = false;
        document.getElementById('nextButton').disabled = true;
        document.getElementById('stepIndicator').textContent = 'Step 2 of 4';
        
        // For mobile, check if drone is selected
        if (selectedPlatform === 'mobile' && selectedDrone) {
            document.getElementById('nextButton').disabled = false;
        }
    }
    
    function showStep3() {
        // Hide all steps
        document.querySelectorAll('.step-content').forEach(step => {
            step.classList.remove('active');
        });
        
        // Show step 3
        document.getElementById('step3-downloads').classList.add('active');
        
        // Update navigation
        document.getElementById('prevButton').disabled = false;
        document.getElementById('nextButton').disabled = false;
        document.getElementById('stepIndicator').textContent = 'Step 3 of 4';
        
        // Load downloads based on platform
        loadDownloads();
    }
    
    function showStep4() {
        // Hide all steps
        document.querySelectorAll('.step-content').forEach(step => {
            step.classList.remove('active');
        });
        
        // Show step 4
        document.getElementById('step4-setup').classList.add('active');
        
        // Update navigation
        document.getElementById('prevButton').disabled = false;
        document.getElementById('nextButton').style.display = 'none';
        document.getElementById('stepIndicator').textContent = 'Step 4 of 4';
        
        // Generate setup instructions
        generateSetupInstructions();
    }
    
    function updateProgress() {
        // Update progress indicators
        const progressSteps = document.querySelectorAll('.progress-step');
        progressSteps.forEach((step, index) => {
            const stepNumber = index + 1;
            if (stepNumber < currentStep) {
                step.classList.remove('active');
                step.classList.add('completed');
            } else if (stepNumber === currentStep) {
                step.classList.remove('completed');
                step.classList.add('active');
            } else {
                step.classList.remove('active', 'completed');
            }
        });
    }
    
    async function loadDownloads() {
        try {
            document.getElementById('downloads-loading').style.display = 'block';
            document.getElementById('downloads-error').style.display = 'none';
            document.getElementById('desktop-downloads').style.display = 'none';
            document.getElementById('mobile-downloads').style.display = 'none';
            
            if (selectedPlatform === 'desktop') {
                await loadDesktopReleases();
            } else if (selectedPlatform === 'mobile') {
                await loadMobileReleases();
            }
            
        } catch (error) {
            console.error('Error loading downloads:', error);
            document.getElementById('downloads-loading').style.display = 'none';
            document.getElementById('downloads-error').style.display = 'block';
        }
    }
    
    async function loadDesktopReleases() {
        try {
            let platformFilter = '';
            if (selectedOSPlatform === 'windows') {
                platformFilter = 'Windows';
            } else if (selectedOSPlatform === 'macos-apple') {
                platformFilter = 'macOS Apple';  // Backend expects this format
            } else if (selectedOSPlatform === 'macos-intel') {
                platformFilter = 'macOS Intel';  // Backend expects this format
            }
            
            // Try to fetch from API
            try {
                const releases = await fetchSoftwareReleases('Eagle Eyes Scan', platformFilter);
                displayVersionCards(releases, 'desktop-versions');
            } catch (apiError) {
                console.warn('API fetch failed, using static downloads:', apiError);
                // Fall back to static download buttons
                displayStaticDesktopDownloads(platformFilter);
            }
            
            // Display user-friendly names in the UI
            let displayName = platformFilter;
            if (platformFilter === 'macOS Apple') {
                displayName = 'macOS (Apple silicon)';
            } else if (platformFilter === 'macOS Intel') {
                displayName = 'macOS (Intel)';
            }
            
            document.getElementById('download-title').textContent = 'Download Eagle Eyes Scan';
            document.getElementById('download-description').textContent = `Available versions for ${displayName}`;
            
            document.getElementById('downloads-loading').style.display = 'none';
            document.getElementById('desktop-downloads').style.display = 'block';
            
        } catch (error) {
            throw error;
        }
    }
    
    async function loadMobileReleases() {
        try {
            // Try to fetch from API
            try {
                const releases = await fetchSoftwareReleases('Eagle Eyes Pilot', 'Android SDK5');
                displayVersionCards(releases, 'mobile-versions');
            } catch (apiError) {
                console.warn('API fetch failed, using static downloads:', apiError);
                // Fall back to static download button
                displayStaticMobileDownloads();
            }
            
            document.getElementById('download-title').textContent = 'Download Eagle Eyes Pilot';
            document.getElementById('download-description').textContent = 'Available versions for Android';
            
            document.getElementById('downloads-loading').style.display = 'none';
            document.getElementById('mobile-downloads').style.display = 'block';
            
        } catch (error) {
            throw error;
        }
    }
    
    async function fetchSoftwareReleases(product, platform) {
        const url = `${hostURL}/get_software_releases?product=${encodeURIComponent(product)}&platform=${encodeURIComponent(platform)}`;
        
        const response = await fetch(url, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        if (!response.ok) {
            throw new Error('Failed to fetch software releases');
        }
        
        const data = await response.json();
        console.log('API Response:', data);
        
        // Handle different response formats
        let releases = [];
        
        if (Array.isArray(data)) {
            // Response is directly an array
            releases = data;
        } else if (data && Array.isArray(data.releases)) {
            // Response has releases property
            releases = data.releases;
        } else if (data && Array.isArray(data.data)) {
            // Response has data property
            releases = data.data;
        } else if (data && Array.isArray(data.results)) {
            // Response has results property
            releases = data.results;
        } else {
            console.warn('Unexpected API response format:', data);
            // If we can't find an array, return empty array
            releases = [];
        }
        
        console.log('Processed releases:', releases);
        return releases;
    }
    
    function displayVersionCards(releases, containerId) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        
        // Validate that releases is an array
        if (!Array.isArray(releases)) {
            console.error('displayVersionCards expects an array, got:', typeof releases, releases);
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Error: Invalid data format received from server.</p>';
            return;
        }
        
        if (releases.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: #6c757d;">No releases available.</p>';
            return;
        }
        
        releases.forEach(release => {
            const versionCard = createVersionCard(release);
            container.appendChild(versionCard);
        });
    }
    
    function createVersionCard(release) {
        const card = document.createElement('div');
        card.className = 'version-card';
        
        // Map API field names to expected names
        const versionType = (release.type || release.version_type || 'stable').toLowerCase();
        const badgeClass = versionType === 'stable' ? 'stable' : 
                          versionType === 'beta' ? 'beta' : 'alpha';
        
        const downloadUrl = release.download_link || release.download_url || '#';
        const fileSize = release.file_size ? formatFileSize(release.file_size) : '';
        
        // Use product name from release or determine based on platform
        const productName = release.product || (selectedPlatform === 'desktop' ? 'Eagle Eyes Scan' : 'Eagle Eyes Pilot');
        
        // Generate a unique ID if not provided
        const releaseId = release.id || `${release.product}_${release.version}_${release.platform}`.replace(/\s+/g, '_');
        
        card.innerHTML = `
            <div class="version-header">
                <div class="product-name">${productName}</div>
                <div class="version-name">${release.version}</div>
                <div class="version-date">Release date: ${formatDate(release.release_date)}</div>
                <div class="version-badge ${badgeClass}">${versionType}</div>
            </div>
            
            ${release.release_notes && release.release_notes.trim() ? `
                <div class="release-notes">
                    <h4>Release Notes</h4>
                    <ul>
                        ${release.release_notes.split('\n').map(note => note.trim() ? `<li>${note}</li>` : '').join('')}
                    </ul>
                </div>
            ` : ''}
            
            ${versionType === 'beta' ? `
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 6px; padding: 15px; margin: 15px 0; font-style: italic; color: #856404; font-size: 13px; line-height: 1.4;">
                    ${productName === 'Eagle Eyes Pilot' ? 
                        'This is a beta release with early access to new features. You may encounter errors. In case that happens during flight, you can always switch to the standard DJI piloting app. We would appreciate any feedback to info@eagleeyessearch.com.' :
                        'This is a beta release with early access to new features. You may encounter errors. We would appreciate any feedback to info@eagleeyessearch.com.'
                    }
                </div>
            ` : ''}
            
            <div class="version-actions">
                <a href="${downloadUrl}" class="download-button" onclick="trackDownload('${releaseId}'); return true;">
                    Download
                </a>
                ${fileSize ? `<div class="file-info">${fileSize}</div>` : ''}
            </div>
        `;
        
        return card;
    }
    
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    function formatDate(dateString) {
        if (!dateString) return 'Unknown date';
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric' 
        });
    }
    
    function generateSetupInstructions() {
        const setupSteps = document.getElementById('setup-steps');
        const tutorialLink = document.getElementById('tutorial-link');
        const manualLink = document.getElementById('manual-link');
        
        let steps = [];
        
        if (selectedPlatform === 'desktop') {
            // Platform-specific installation instructions
            let installationText = '';
            if (selectedOSPlatform === 'windows') {
                installationText = 'Double-click the .exe file and follow the installation instructions.';
            } else if (selectedOSPlatform === 'macos-apple' || selectedOSPlatform === 'macos-intel') {
                installationText = 'Unzip the downloaded file by double-clicking on it. Then move the application to your Applications folder.';
            } else {
                // Fallback generic instruction
                installationText = 'Run the downloaded installer and follow the installation wizard';
            }
            
            steps = [
                { title: 'Install the Application', text: installationText },
                { title: 'Activate the software on your device', text: 'Open Eagle Eyes Scan and click the "üîë" button. Enter your License ID and follow the instructions.' },
                { title: 'Explore our features', text: 'First time user? We recommend taking a looking at our quick start guide below.' }
            ];
            tutorialLink.href = 'https://www.eagleeyessearch.com/scan#tutorial';
            manualLink.href = 'https://docs.google.com/document/d/12mhRVmhtQUfvJHy7tI7mB_oLd3aRqYJJPWzKlhKnTwY/edit?tab=t.0#heading=h.gid4fjjhiq1p';
        } else {
            steps = [
                { title: 'Install the APK', text: 'Install the downloaded .apk on your device. If it‚Äôs blocked, enable ‚ÄúInstall from Unknown Sources‚Äù in your settings.' },
                { title: 'Activate your license', text: `Open Eagle Eyes Pilot. When asked for location access, set it to "While using the app".<br>In the main menu, tap the button next to ‚ÄúNo License. Get one here ‚Üí‚Äù and follow the steps.` },
                { title: 'Configure Your Device and start flying!', text: 'Setup your controller via "..." -> Setup Controller. <br>Once you connect your controller, you are ready to fly!' }
            ];
            tutorialLink.href = 'https://www.eagleeyessearch.com/pilot#tutorial';
            manualLink.href = 'https://docs.google.com/document/d/1Uq8lHS-V7B7ekQ9h6gRrnnclu9vuM4zKRBzB3tS0fGQ/edit?tab=t.0#heading=h.vnrae2q60d57';
        }
        
        // Clear existing steps
        setupSteps.innerHTML = '';
        
        // Add new steps
        steps.forEach((step, index) => {
            const stepElement = document.createElement('li');
            stepElement.innerHTML = `
                <div class="step-number">${index + 1}</div>
                <div class="step-text">
                    <strong>${step.title}</strong>
                    ${step.text}
                </div>
            `;
            setupSteps.appendChild(stepElement);
        });
    }
    
    // Mobile device selection functionality
    function setupMobileDeviceSelection() {
        // Drone selection
        $('#droneList .device-tile').click(function() {
            $('#droneList .device-tile').removeClass('selected');
            $(this).addClass('selected');
            selectedDrone = {
                device: $(this).data('device'),
                compatibility: $(this).data('compatibility'),
                name: $(this).find('.device-name').text()
            };
            updateCompatibilityMessage();
            updateMobileNextButton();
        });
        
        // Controller selection
        $('#controllerList .device-tile').click(function() {
            $('#controllerList .device-tile').removeClass('selected');
            $(this).addClass('selected');
            selectedController = {
                device: $(this).data('device'),
                compatibility: $(this).data('compatibility'),
                name: $(this).find('.device-name').text()
            };
            updateCompatibilityMessage();
            updateMobileNextButton();
        });
    }
    
    function updateCompatibilityMessage() {
        const messageDiv = $('#compatibilityMessage');
        
        if (!selectedDrone || !selectedController) {
            messageDiv.hide();
            return;
        }
        
        let message = '';
        let messageClass = '';
        
        if (selectedDrone.compatibility === 'supported' && selectedController.compatibility === 'supported') {
            message = `‚úÖ Great choice! ${selectedDrone.name} with ${selectedController.name} is fully supported by Eagle Eyes Pilot.`;
            messageClass = 'compatibility-supported';
        } else if (selectedDrone.compatibility === 'incompatible' || selectedController.compatibility === 'incompatible') {
            message = `‚ùå Unfortunately, your selected combination (${selectedDrone.name} + ${selectedController.name}) is not currently supported. Eagle Eyes Pilot may not work properly with this setup.`;
            messageClass = 'compatibility-error';
        } else {
            message = `‚ö†Ô∏è Your combination (${selectedDrone.name} + ${selectedController.name}) may work but hasn't been fully tested. Results may vary.`;
            messageClass = 'compatibility-warning';
        }
        
        messageDiv.text(message)
            .removeClass('compatibility-supported compatibility-warning compatibility-error')
            .addClass(messageClass)
            .show();
    }
    
    function updateMobileNextButton() {
        // Enable next button only if a supported drone is selected (not "other")
        if (selectedDrone && selectedDrone.compatibility !== 'unsupported') {
            document.getElementById('nextButton').disabled = false;
        } else {
            document.getElementById('nextButton').disabled = true;
        }
    }
    
    function trackDownload(versionId) {
        console.log('Download tracked:', versionId);
        // Add download tracking logic here
    }
    
    function displayStaticDesktopDownloads(platformFilter) {
        const container = document.getElementById('desktop-versions');
        container.innerHTML = `
            <div style="text-align: center; padding: 40px 20px; background: #f8f9fa; border-radius: 8px; margin: 20px 0;">
                <h3 style="color: #dc3545; margin-bottom: 15px;">Download Temporarily Unavailable</h3>
                <p style="color: #6c757d; margin-bottom: 20px;">
                    We're unable to load the available downloads at this time.
                </p>
                <p style="color: #495057;">
                    Please contact us for download links:<br>
                    <a href="mailto:info@eagleeyessearch.com" style="color: #007bff; text-decoration: none; font-weight: 600;">
                        info@eagleeyessearch.com
                    </a>
                </p>
            </div>
        `;
    }
    
    function displayStaticMobileDownloads() {
        const container = document.getElementById('mobile-versions');
        container.innerHTML = `
            <div style="text-align: center; padding: 40px 20px; background: #f8f9fa; border-radius: 8px; margin: 20px 0;">
                <h3 style="color: #dc3545; margin-bottom: 15px;">Download Temporarily Unavailable</h3>
                <p style="color: #6c757d; margin-bottom: 20px;">
                    We're unable to load the available downloads at this time.
                </p>
                <p style="color: #495057;">
                    Please contact us for download links:<br>
                    <a href="mailto:info@eagleeyessearch.com" style="color: #007bff; text-decoration: none; font-weight: 600;">
                        info@eagleeyessearch.com
                    </a>
                </p>
            </div>
        `;
    }
</script>
